<!doctype html>
<html lang="id" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jurnal Mengajar Guru</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    * {
      font-family: 'Inter', sans-serif;
    }
    
    .app-container {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .card-shadow {
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }
    
    .btn-primary {
      transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    
    .input-field {
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }
    
    .input-field:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .loading-spinner {
      border: 3px solid #f3f4f6;
      border-top: 3px solid #667eea;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 16px 24px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      animation: slideIn 0.3s ease;
    }
    
    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    .modal-backdrop {
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
    }
    
    .jurnal-card {
      transition: all 0.3s ease;
    }
    
    .jurnal-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full overflow-auto">
  <div class="app-container w-full min-h-full">
   <div class="w-full max-w-6xl mx-auto px-4 py-8"><!-- Header Section -->
    <div class="bg-white rounded-2xl card-shadow p-8 mb-8">
     <div class="flex items-center gap-6 mb-6">
      <div class="w-24 h-24 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-full flex items-center justify-center text-white text-4xl font-bold flex-shrink-0">
       üë®‚Äçüè´
      </div>
      <div class="flex-1">
       <h1 class="text-3xl font-bold text-gray-800 mb-2" id="app-title">Jurnal Mengajar Guru</h1>
       <p class="text-lg text-gray-600" id="nama-guru-display">Mokhamad Syukron Ni'am, S.Pd., M.Pd.</p>
       <p class="text-sm text-gray-500" id="nip-guru-display">NIP: 6</p>
      </div>
     </div>
     <div class="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-6">
      <p class="text-gray-700 text-center" id="sambutan-display">Selamat datang di aplikasi Jurnal Mengajar. Catat setiap kegiatan pembelajaran Anda dengan mudah dan terorganisir.</p>
     </div>
    </div><!-- Main Content -->
    <div id="main-view"><!-- Action Buttons -->
     <div class="flex gap-4 mb-6"><button onclick="showAddJurnalForm()" class="btn-primary bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-6 py-3 rounded-xl font-semibold flex items-center gap-2"> <span class="text-xl">‚ûï</span> Tambah Jurnal </button> <button onclick="showDownloadOptions()" class="btn-primary bg-white text-indigo-600 px-6 py-3 rounded-xl font-semibold border-2 border-indigo-600 flex items-center gap-2"> <span class="text-xl">üì•</span> Download Jurnal </button>
     </div><!-- Jurnal List -->
     <div id="jurnal-list" class="space-y-4"><!-- Jurnal items will be populated here -->
     </div>
     <div id="empty-state" class="bg-white rounded-2xl card-shadow p-12 text-center">
      <div class="text-6xl mb-4">
       üìö
      </div>
      <h3 class="text-xl font-semibold text-gray-700 mb-2">Belum Ada Jurnal</h3>
      <p class="text-gray-500 mb-6">Mulai catat kegiatan mengajar Anda dengan klik tombol Tambah Jurnal</p>
     </div>
    </div><!-- Add/Edit Form Modal -->
    <div id="form-modal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50 p-4" style="display: none;">
     <div class="bg-white rounded-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto card-shadow">
      <div class="sticky top-0 bg-gradient-to-r from-indigo-600 to-purple-600 text-white p-6 rounded-t-2xl">
       <h2 class="text-2xl font-bold" id="form-title">Tambah Jurnal Mengajar</h2>
      </div>
      <form id="jurnal-form" class="p-6 space-y-6">
       <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div><label class="block text-sm font-semibold text-gray-700 mb-2">Hari</label> <select id="hari" required class="input-field w-full px-4 py-3 border-2 border-gray-200 rounded-xl"> <option value="">Pilih Hari</option> <option value="Senin">Senin</option> <option value="Selasa">Selasa</option> <option value="Rabu">Rabu</option> <option value="Kamis">Kamis</option> <option value="Jumat">Jumat</option> <option value="Sabtu">Sabtu</option> </select>
        </div>
        <div><label class="block text-sm font-semibold text-gray-700 mb-2">Tanggal</label> <input type="date" id="tanggal" required class="input-field w-full px-4 py-3 border-2 border-gray-200 rounded-xl">
        </div>
       </div>
       <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div><label class="block text-sm font-semibold text-gray-700 mb-2">Kelas</label> <select id="kelas" required class="input-field w-full px-4 py-3 border-2 border-gray-200 rounded-xl"> <option value="">Pilih Kelas</option> <option value="IX.1">IX.1</option> <option value="IX.2">IX.2</option> <option value="IX.3">IX.3</option> <option value="IX.4">IX.4</option> </select>
        </div>
        <div><label class="block text-sm font-semibold text-gray-700 mb-2">Jam Pelajaran Mulai</label> <select id="jam-mulai" required class="input-field w-full px-4 py-3 border-2 border-gray-200 rounded-xl"> <option value="">Pilih</option> <option value="1">1</option> <option value="2">2</option> <option value="3">3</option> <option value="4">4</option> <option value="5">5</option> <option value="6">6</option> <option value="7">7</option> <option value="8">8</option> </select>
        </div>
        <div><label class="block text-sm font-semibold text-gray-700 mb-2">Sampai Jam</label> <select id="jam-selesai" required class="input-field w-full px-4 py-3 border-2 border-gray-200 rounded-xl"> <option value="">Pilih</option> <option value="1">1</option> <option value="2">2</option> <option value="3">3</option> <option value="4">4</option> <option value="5">5</option> <option value="6">6</option> <option value="7">7</option> <option value="8">8</option> </select>
        </div>
       </div>
       <div><label class="block text-sm font-semibold text-gray-700 mb-2">Materi Pembelajaran</label> <textarea id="materi" required rows="3" class="input-field w-full px-4 py-3 border-2 border-gray-200 rounded-xl" placeholder="Tuliskan materi yang diajarkan..."></textarea>
       </div>
       <div><label class="block text-sm font-semibold text-gray-700 mb-2">Refleksi Pembelajaran</label> <textarea id="refleksi" required rows="3" class="input-field w-full px-4 py-3 border-2 border-gray-200 rounded-xl" placeholder="Refleksi dan catatan pembelajaran..."></textarea>
       </div>
       <div class="bg-gray-50 rounded-xl p-4 space-y-4">
        <h3 class="font-semibold text-gray-800">Kehadiran Murid</h3>
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
         <div><label class="block text-sm font-medium text-gray-700 mb-2">Jumlah Murid</label> <input type="number" id="jumlah-murid" required min="0" class="input-field w-full px-3 py-2 border-2 border-gray-200 rounded-lg">
         </div>
         <div><label class="block text-sm font-medium text-gray-700 mb-2">Sakit</label> <input type="number" id="sakit" value="0" min="0" class="input-field w-full px-3 py-2 border-2 border-gray-200 rounded-lg">
         </div>
         <div><label class="block text-sm font-medium text-gray-700 mb-2">Ijin</label> <input type="number" id="ijin" value="0" min="0" class="input-field w-full px-3 py-2 border-2 border-gray-200 rounded-lg">
         </div>
         <div><label class="block text-sm font-medium text-gray-700 mb-2">Alpa</label> <input type="number" id="alpa" value="0" min="0" class="input-field w-full px-3 py-2 border-2 border-gray-200 rounded-lg">
         </div>
         <div><label class="block text-sm font-medium text-gray-700 mb-2">Terlambat</label> <input type="number" id="terlambat" value="0" min="0" class="input-field w-full px-3 py-2 border-2 border-gray-200 rounded-lg">
         </div>
        </div>
       </div>
       <div class="flex gap-3 pt-4"><button type="submit" id="submit-btn" class="btn-primary flex-1 bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-3 rounded-xl font-semibold"> üíæ Simpan Jurnal </button> <button type="button" onclick="closeFormModal()" class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-xl font-semibold"> Batal </button>
       </div>
      </form>
     </div>
    </div><!-- Download Options Modal -->
    <div id="download-modal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50 p-4" style="display: none;">
     <div class="bg-white rounded-2xl w-full max-w-md card-shadow p-6">
      <h2 class="text-2xl font-bold text-gray-800 mb-6">Download Jurnal</h2>
      <div class="space-y-4">
       <div><label class="block text-sm font-semibold text-gray-700 mb-2">Pilih Tanggal</label> <input type="date" id="download-date" class="input-field w-full px-4 py-3 border-2 border-gray-200 rounded-xl">
       </div>
       <div><label class="block text-sm font-semibold text-gray-700 mb-2">Pilih Bulan &amp; Tahun</label> <input type="month" id="download-month" class="input-field w-full px-4 py-3 border-2 border-gray-200 rounded-xl">
       </div>
       <div class="pt-4 space-y-3"><button onclick="downloadHarian()" class="w-full btn-primary bg-gradient-to-r from-green-500 to-emerald-600 text-white py-3 rounded-xl font-semibold"> üìÑ Download Jurnal Harian </button> <button onclick="downloadBulanan()" class="w-full btn-primary bg-gradient-to-r from-blue-500 to-cyan-600 text-white py-3 rounded-xl font-semibold"> üìä Download Jurnal Bulanan </button> <button onclick="closeDownloadModal()" class="w-full bg-gray-200 text-gray-700 py-3 rounded-xl font-semibold"> Batal </button>
       </div>
      </div>
     </div>
    </div>
   </div>
  </div>
  <script>
    let jurnalData = [];
    let editingId = null;

    const defaultConfig = {
      nama_guru: "Mokhamad Syukron Ni'am, S.Pd., M.Pd.",
      nip_guru: "6",
      nama_kepala_sekolah: "Mukhidin, S.Pd.",
      nip_kepala_sekolah: "06",
      teks_sambutan: "Selamat datang di aplikasi Jurnal Mengajar. Catat setiap kegiatan pembelajaran Anda dengan mudah dan terorganisir."
    };

    const dataHandler = {
      onDataChanged(data) {
        jurnalData = data;
        renderJurnalList();
      }
    };

    async function onConfigChange(config) {
      document.getElementById('nama-guru-display').textContent = config.nama_guru || defaultConfig.nama_guru;
      document.getElementById('nip-guru-display').textContent = 'NIP: ' + (config.nip_guru || defaultConfig.nip_guru);
      document.getElementById('sambutan-display').textContent = config.teks_sambutan || defaultConfig.teks_sambutan;
    }

    function mapToCapabilities(config) {
      return {
        recolorables: [],
        borderables: [],
        fontEditable: undefined,
        fontSizeable: undefined
      };
    }

    function mapToEditPanelValues(config) {
      return new Map([
        ["nama_guru", config.nama_guru || defaultConfig.nama_guru],
        ["nip_guru", config.nip_guru || defaultConfig.nip_guru],
        ["nama_kepala_sekolah", config.nama_kepala_sekolah || defaultConfig.nama_kepala_sekolah],
        ["nip_kepala_sekolah", config.nip_kepala_sekolah || defaultConfig.nip_kepala_sekolah],
        ["teks_sambutan", config.teks_sambutan || defaultConfig.teks_sambutan]
      ]);
    }

    async function initializeApp() {
      if (window.elementSdk) {
        await window.elementSdk.init({
          defaultConfig,
          onConfigChange,
          mapToCapabilities,
          mapToEditPanelValues
        });
      }

      if (window.dataSdk) {
        const result = await window.dataSdk.init(dataHandler);
        if (!result.isOk) {
          showToast('Gagal menginisialisasi aplikasi', 'error');
        }
      }
    }

    function renderJurnalList() {
      const listContainer = document.getElementById('jurnal-list');
      const emptyState = document.getElementById('empty-state');
      
      if (jurnalData.length === 0) {
        listContainer.innerHTML = '';
        emptyState.style.display = 'block';
        return;
      }
      
      emptyState.style.display = 'none';
      
      const sortedData = [...jurnalData].sort((a, b) => {
        return new Date(b.tanggal) - new Date(a.tanggal);
      });
      
      listContainer.innerHTML = sortedData.map(jurnal => {
        const tidakHadir = parseInt(jurnal.sakit || 0) + parseInt(jurnal.ijin || 0) + 
                          parseInt(jurnal.alpa || 0) + parseInt(jurnal.terlambat || 0);
        
        return `
          <div class="jurnal-card bg-white rounded-xl card-shadow p-6">
            <div class="flex justify-between items-start mb-4">
              <div>
                <div class="flex items-center gap-3 mb-2">
                  <span class="bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full text-sm font-semibold">${jurnal.hari}</span>
                  <span class="text-gray-600">${formatTanggal(jurnal.tanggal)}</span>
                </div>
                <h3 class="text-xl font-bold text-gray-800">Kelas ${jurnal.kelas} ‚Ä¢ Jam ${jurnal.jam_mulai}-${jurnal.jam_selesai}</h3>
              </div>
              <div class="flex gap-2">
                <button onclick="editJurnal('${jurnal.__backendId}')" class="text-indigo-600 hover:bg-indigo-50 p-2 rounded-lg transition">
                  ‚úèÔ∏è
                </button>
                <button onclick="confirmDelete('${jurnal.__backendId}')" class="text-red-600 hover:bg-red-50 p-2 rounded-lg transition">
                  üóëÔ∏è
                </button>
              </div>
            </div>
            
            <div class="space-y-3">
              <div>
                <p class="text-sm font-semibold text-gray-600 mb-1">Materi:</p>
                <p class="text-gray-800">${jurnal.materi}</p>
              </div>
              
              <div>
                <p class="text-sm font-semibold text-gray-600 mb-1">Refleksi:</p>
                <p class="text-gray-800">${jurnal.refleksi}</p>
              </div>
              
              <div class="bg-gray-50 rounded-lg p-4">
                <p class="text-sm font-semibold text-gray-700 mb-2">Kehadiran Murid:</p>
                <div class="grid grid-cols-2 md:grid-cols-6 gap-3 text-sm">
                  <div>
                    <p class="text-gray-600">Total</p>
                    <p class="font-bold text-gray-800">${jurnal.jumlah_murid}</p>
                  </div>
                  <div>
                    <p class="text-gray-600">Tidak Hadir</p>
                    <p class="font-bold text-red-600">${tidakHadir}</p>
                  </div>
                  <div>
                    <p class="text-gray-600">Sakit</p>
                    <p class="font-semibold text-gray-700">${jurnal.sakit || 0}</p>
                  </div>
                  <div>
                    <p class="text-gray-600">Ijin</p>
                    <p class="font-semibold text-gray-700">${jurnal.ijin || 0}</p>
                  </div>
                  <div>
                    <p class="text-gray-600">Alpa</p>
                    <p class="font-semibold text-gray-700">${jurnal.alpa || 0}</p>
                  </div>
                  <div>
                    <p class="text-gray-600">Terlambat</p>
                    <p class="font-semibold text-gray-700">${jurnal.terlambat || 0}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    function formatTanggal(dateStr) {
      const date = new Date(dateStr);
      const options = { day: 'numeric', month: 'long', year: 'numeric' };
      return date.toLocaleDateString('id-ID', options);
    }

    function showAddJurnalForm() {
      editingId = null;
      document.getElementById('form-title').textContent = 'Tambah Jurnal Mengajar';
      document.getElementById('jurnal-form').reset();
      document.getElementById('form-modal').style.display = 'flex';
    }

    function editJurnal(id) {
      const jurnal = jurnalData.find(j => j.__backendId === id);
      if (!jurnal) return;
      
      editingId = id;
      document.getElementById('form-title').textContent = 'Edit Jurnal Mengajar';
      
      document.getElementById('hari').value = jurnal.hari;
      document.getElementById('tanggal').value = jurnal.tanggal;
      document.getElementById('kelas').value = jurnal.kelas;
      document.getElementById('jam-mulai').value = jurnal.jam_mulai;
      document.getElementById('jam-selesai').value = jurnal.jam_selesai;
      document.getElementById('materi').value = jurnal.materi;
      document.getElementById('refleksi').value = jurnal.refleksi;
      document.getElementById('jumlah-murid').value = jurnal.jumlah_murid;
      document.getElementById('sakit').value = jurnal.sakit || 0;
      document.getElementById('ijin').value = jurnal.ijin || 0;
      document.getElementById('alpa').value = jurnal.alpa || 0;
      document.getElementById('terlambat').value = jurnal.terlambat || 0;
      
      document.getElementById('form-modal').style.display = 'flex';
    }

    function confirmDelete(id) {
      const card = event.target.closest('.jurnal-card');
      const buttonContainer = event.target.closest('.flex.gap-2');
      
      buttonContainer.innerHTML = `
        <button onclick="deleteJurnal('${id}')" class="bg-red-600 text-white px-3 py-1 rounded-lg text-sm font-semibold">
          Konfirmasi Hapus
        </button>
        <button onclick="renderJurnalList()" class="bg-gray-300 text-gray-700 px-3 py-1 rounded-lg text-sm font-semibold">
          Batal
        </button>
      `;
    }

    async function deleteJurnal(id) {
      const jurnal = jurnalData.find(j => j.__backendId === id);
      if (!jurnal) return;
      
      const result = await window.dataSdk.delete(jurnal);
      if (result.isOk) {
        showToast('Jurnal berhasil dihapus', 'success');
      } else {
        showToast('Gagal menghapus jurnal', 'error');
        renderJurnalList();
      }
    }

    function closeFormModal() {
      document.getElementById('form-modal').style.display = 'none';
      editingId = null;
    }

    document.getElementById('jurnal-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      if (jurnalData.length >= 999 && !editingId) {
        showToast('Maksimal 999 jurnal tercapai. Silakan hapus beberapa jurnal terlebih dahulu.', 'error');
        return;
      }
      
      const submitBtn = document.getElementById('submit-btn');
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<div class="loading-spinner mx-auto"></div>';
      
      const formData = {
        hari: document.getElementById('hari').value,
        tanggal: document.getElementById('tanggal').value,
        kelas: document.getElementById('kelas').value,
        jam_mulai: parseInt(document.getElementById('jam-mulai').value),
        jam_selesai: parseInt(document.getElementById('jam-selesai').value),
        materi: document.getElementById('materi').value,
        refleksi: document.getElementById('refleksi').value,
        jumlah_murid: parseInt(document.getElementById('jumlah-murid').value),
        tidak_hadir: parseInt(document.getElementById('sakit').value || 0) + 
                    parseInt(document.getElementById('ijin').value || 0) + 
                    parseInt(document.getElementById('alpa').value || 0) + 
                    parseInt(document.getElementById('terlambat').value || 0),
        sakit: parseInt(document.getElementById('sakit').value || 0),
        ijin: parseInt(document.getElementById('ijin').value || 0),
        alpa: parseInt(document.getElementById('alpa').value || 0),
        terlambat: parseInt(document.getElementById('terlambat').value || 0)
      };
      
      let result;
      if (editingId) {
        const existingJurnal = jurnalData.find(j => j.__backendId === editingId);
        result = await window.dataSdk.update({ ...existingJurnal, ...formData });
      } else {
        formData.id = 'jurnal_' + Date.now();
        formData.createdAt = new Date().toISOString();
        result = await window.dataSdk.create(formData);
      }
      
      submitBtn.disabled = false;
      submitBtn.innerHTML = 'üíæ Simpan Jurnal';
      
      if (result.isOk) {
        showToast(editingId ? 'Jurnal berhasil diupdate' : 'Jurnal berhasil ditambahkan', 'success');
        closeFormModal();
      } else {
        showToast('Gagal menyimpan jurnal', 'error');
      }
    });

    function showDownloadOptions() {
      const today = new Date();
      document.getElementById('download-date').value = today.toISOString().split('T')[0];
      document.getElementById('download-month').value = today.toISOString().slice(0, 7);
      document.getElementById('download-modal').style.display = 'flex';
    }

    function closeDownloadModal() {
      document.getElementById('download-modal').style.display = 'none';
    }

    function downloadHarian() {
      const selectedDate = document.getElementById('download-date').value;
      if (!selectedDate) {
        showToast('Silakan pilih tanggal terlebih dahulu', 'error');
        return;
      }
      
      const filteredData = jurnalData.filter(j => j.tanggal === selectedDate);
      
      if (filteredData.length === 0) {
        showToast('Tidak ada jurnal untuk tanggal tersebut', 'error');
        return;
      }
      
      generateHarianDocument(filteredData, selectedDate);
      closeDownloadModal();
    }

    function downloadBulanan() {
      const selectedMonth = document.getElementById('download-month').value;
      if (!selectedMonth) {
        showToast('Silakan pilih bulan terlebih dahulu', 'error');
        return;
      }
      
      const [year, month] = selectedMonth.split('-');
      const filteredData = jurnalData.filter(j => {
        const jurnalDate = new Date(j.tanggal);
        return jurnalDate.getFullYear() === parseInt(year) && 
               (jurnalDate.getMonth() + 1) === parseInt(month);
      });
      
      if (filteredData.length === 0) {
        showToast('Tidak ada jurnal untuk bulan tersebut', 'error');
        return;
      }
      
      generateBulananDocument(filteredData, year, month);
      closeDownloadModal();
    }

    function generateHarianDocument(data, date) {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      const formattedDate = formatTanggal(date);
      
      let html = `
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset="UTF-8">
          <title>Jurnal Mengajar Harian - ${formattedDate}</title>
          <style>
            body { font-family: Arial, sans-serif; margin: 40px; }
            h1 { text-align: center; margin-bottom: 30px; }
            .header { margin-bottom: 30px; }
            .jurnal-item { margin-bottom: 30px; page-break-inside: avoid; border: 1px solid #ddd; padding: 15px; }
            table { width: 100%; border-collapse: collapse; margin-top: 10px; }
            td { padding: 8px; border: 1px solid #ddd; }
            .signature { margin-top: 50px; display: flex; justify-content: space-between; }
            .signature-box { text-align: center; width: 40%; }
          </style>
        </head>
        <body>
          <h1>JURNAL MENGAJAR HARIAN</h1>
          <div class="header">
            <p><strong>Nama Guru:</strong> ${config.nama_guru || defaultConfig.nama_guru}</p>
            <p><strong>NIP:</strong> ${config.nip_guru || defaultConfig.nip_guru}</p>
            <p><strong>Tanggal:</strong> ${formattedDate}</p>
          </div>
      `;
      
      data.forEach((jurnal, index) => {
        const tidakHadir = (jurnal.sakit || 0) + (jurnal.ijin || 0) + (jurnal.alpa || 0) + (jurnal.terlambat || 0);
        
        html += `
          <div class="jurnal-item">
            <h3>Entry ${index + 1}: ${jurnal.hari}, Kelas ${jurnal.kelas}</h3>
            <p><strong>Jam Pelajaran:</strong> ${jurnal.jam_mulai} - ${jurnal.jam_selesai}</p>
            <p><strong>Materi:</strong> ${jurnal.materi}</p>
            <p><strong>Refleksi:</strong> ${jurnal.refleksi}</p>
            
            <table>
              <tr>
                <td><strong>Jumlah Murid</strong></td>
                <td>${jurnal.jumlah_murid}</td>
                <td><strong>Tidak Hadir</strong></td>
                <td>${tidakHadir}</td>
              </tr>
              <tr>
                <td><strong>Sakit</strong></td>
                <td>${jurnal.sakit || 0}</td>
                <td><strong>Ijin</strong></td>
                <td>${jurnal.ijin || 0}</td>
              </tr>
              <tr>
                <td><strong>Alpa</strong></td>
                <td>${jurnal.alpa || 0}</td>
                <td><strong>Terlambat</strong></td>
                <td>${jurnal.terlambat || 0}</td>
              </tr>
            </table>
          </div>
        `;
      });
      
      html += `
          <div class="signature">
            <div class="signature-box">
              <p>${formattedDate}</p>
              <p>Guru Mata Pelajaran</p>
              <br><br><br>
              <p><strong>${config.nama_guru || defaultConfig.nama_guru}</strong></p>
              <p>NIP. ${config.nip_guru || defaultConfig.nip_guru}</p>
            </div>
            <div class="signature-box">
              <p>Mengetahui,</p>
              <p>Kepala Sekolah</p>
              <br><br><br>
              <p><strong>${config.nama_kepala_sekolah || defaultConfig.nama_kepala_sekolah}</strong></p>
              <p>NIP. ${config.nip_kepala_sekolah || defaultConfig.nip_kepala_sekolah}</p>
            </div>
          </div>
        </body>
        </html>
      `;
      
      const newWindow = window.open('', '_blank');
      newWindow.document.write(html);
      newWindow.document.close();
      showToast('Jurnal harian dibuka di tab baru', 'success');
    }

    function generateBulananDocument(data, year, month) {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      const monthNames = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 
                         'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
      const monthName = monthNames[parseInt(month) - 1];
      
      const sortedData = [...data].sort((a, b) => new Date(a.tanggal) - new Date(b.tanggal));
      
      let html = `
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset="UTF-8">
          <title>Jurnal Mengajar Bulanan - ${monthName} ${year}</title>
          <style>
            body { font-family: Arial, sans-serif; margin: 40px; }
            h1 { text-align: center; margin-bottom: 30px; }
            .header { margin-bottom: 30px; }
            table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 11px; }
            th, td { padding: 8px; border: 1px solid #333; text-align: left; }
            th { background-color: #f0f0f0; font-weight: bold; }
            .signature { margin-top: 50px; display: flex; justify-content: space-between; }
            .signature-box { text-align: center; width: 40%; }
          </style>
        </head>
        <body>
          <h1>JURNAL MENGAJAR BULANAN</h1>
          <div class="header">
            <p><strong>Nama Guru:</strong> ${config.nama_guru || defaultConfig.nama_guru}</p>
            <p><strong>NIP:</strong> ${config.nip_guru || defaultConfig.nip_guru}</p>
            <p><strong>Periode:</strong> ${monthName} ${year}</p>
          </div>
          
          <table>
            <thead>
              <tr>
                <th>No</th>
                <th>Hari/Tanggal</th>
                <th>Kelas</th>
                <th>Jam</th>
                <th>Materi</th>
                <th>Hadir</th>
                <th>S</th>
                <th>I</th>
                <th>A</th>
                <th>T</th>
              </tr>
            </thead>
            <tbody>
      `;
      
      sortedData.forEach((jurnal, index) => {
        const hadir = jurnal.jumlah_murid - (jurnal.sakit || 0) - (jurnal.ijin || 0) - (jurnal.alpa || 0) - (jurnal.terlambat || 0);
        
        html += `
          <tr>
            <td>${index + 1}</td>
            <td>${jurnal.hari}, ${formatTanggal(jurnal.tanggal)}</td>
            <td>${jurnal.kelas}</td>
            <td>${jurnal.jam_mulai}-${jurnal.jam_selesai}</td>
            <td>${jurnal.materi}</td>
            <td>${hadir}</td>
            <td>${jurnal.sakit || 0}</td>
            <td>${jurnal.ijin || 0}</td>
            <td>${jurnal.alpa || 0}</td>
            <td>${jurnal.terlambat || 0}</td>
          </tr>
        `;
      });
      
      html += `
            </tbody>
          </table>
          
          <div class="signature">
            <div class="signature-box">
              <p>${new Date().toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' })}</p>
              <p>Guru Mata Pelajaran</p>
              <br><br><br>
              <p><strong>${config.nama_guru || defaultConfig.nama_guru}</strong></p>
              <p>NIP. ${config.nip_guru || defaultConfig.nip_guru}</p>
            </div>
            <div class="signature-box">
              <p>Mengetahui,</p>
              <p>Kepala Sekolah</p>
              <br><br><br>
              <p><strong>${config.nama_kepala_sekolah || defaultConfig.nama_kepala_sekolah}</strong></p>
              <p>NIP. ${config.nip_kepala_sekolah || defaultConfig.nip_kepala_sekolah}</p>
            </div>
          </div>
        </body>
        </html>
      `;
      
      const newWindow = window.open('', '_blank');
      newWindow.document.write(html);
      newWindow.document.close();
      showToast('Jurnal bulanan dibuka di tab baru', 'success');
    }

    function showToast(message, type) {
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.innerHTML = `
        <div class="flex items-center gap-3">
          <span class="text-2xl">${type === 'success' ? '‚úÖ' : '‚ùå'}</span>
          <p class="font-semibold ${type === 'success' ? 'text-green-700' : 'text-red-700'}">${message}</p>
        </div>
      `;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.remove();
      }, 3000);
    }

    initializeApp();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b864fab243555de',t:'MTc2NzQ4MzMxMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
